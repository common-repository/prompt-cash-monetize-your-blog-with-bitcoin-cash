{"version":3,"sources":["webpack://@ekliptor/PromptCash/./src/AbstractModule.ts","webpack://@ekliptor/PromptCash/./src/Gateway.ts","webpack://@ekliptor/PromptCash/./src/Payment.ts","webpack://@ekliptor/PromptCash/./src/PromptCash.ts","webpack://@ekliptor/PromptCash/./src/WebHelpers.ts","webpack://@ekliptor/PromptCash/./src/admin/AdminControls.ts","webpack://@ekliptor/PromptCash/./src/admin/Tooltips.ts","webpack://@ekliptor/PromptCash/./src/structs/PaymentButtonID.ts","webpack://@ekliptor/PromptCash/./src/structs/PaymentMap.ts","webpack://@ekliptor/PromptCash/./src/structs/PaymentResponse.ts","webpack://@ekliptor/PromptCash/./src/structs/RestPaymentParams.ts","webpack://@ekliptor/PromptCash/webpack/bootstrap","webpack://@ekliptor/PromptCash/./index.ts"],"names":["plugin","webHelpers","this","getWebHelpers","config","lastPromptTxId","postID","rand","getRandomString","unixTimestamp","Math","floor","Date","now","amount","currency","type","description","promptTxId","generateRandomTxId","toUpperCase","desc","encodeURI","length","siteUrl","trim","frameUrl","replace","toFixed","len","hex","chars","random","i","charAt","Payment","AbstractModule","super","payments","PaymentMap","paymentType","currentPayID","gateway","Gateway","getConfig","addPayFrameListeners","$","window","document","ready","undefined","woocommerce","paymentPage","addButtonEvents","on","event","showPaymentFrame","target","updateEditableButtonAmount","onMessage","origin","gatewayOrigin","data","func","call","err","console","error","addEventListener","attachEvent","Promise","resolve","reject","status","log","scheduleRemovePayFrame","tx_id","payment","mergeWithExisting","button","find","params","RestPaymentParams","fromButton","fromWoocommerceOrder","getApi","is_restricted","show_search_engines","fadeOut","fadeIn","location","reload","text","res","$btn","buttonIdStr","attr","paymentButtonID","PaymentButtonID","parseFloat","frame","createElement","tr","order","post","src","getPayFrameUrl","title","scrolling","style","overflow","width","height","frameHolder","append","getLastGeneratedTxId","paymentEmpty","PaymentResponse","set","input","$input","val","$buttonWrap","timeoutSec","selector","orderID","setTimeout","remove","PromptCash","consentCookieName","CONSENT_COOKIE_NAME","confirmCookiesMsg","CONFIRM_COOKIES_MSG","confirmCookiesBtn","CONFIRM_COOKIES_BTN","WebHelpers","tooltips","Tooltips","adminControls","AdminControls","init","checkCookieConsent","cssSelectors","navigator","language","substr","toLowerCase","c_name","x","y","ARRcookies","cookie","split","indexOf","decodeURI","name","value","expireDays","date","getTime","cookieLifeDays","toUTCString","cookiePath","click","confirmCookies","getCookie","atob","btoa","variables","safeHtml","toString","e","start","end","placeHolder","substring","translation","key","textPiece","escapeOutput","reg","RegExp","match","convertNewlines","str","args","arguments","test","userAgent","MSStream","cached","originRegex","escapeRegex","styleSheets","sheet","href","rules","u","selectorText","push","imports","selectors","getAllCssSelectors","setCookie","path","callback","dataType","url","fixRelativeUrl","get","textStatus","jqXHR","fullUrl","getTooltips","initToolTips","jQuery","that","tsfL10n","touchBuffer","inTouchBuffer","setEvents","unset","touchEvents","$target","off","body","mouseMove","mouseLeave","touchRemove","updateDesc","classList","contains","tooltipText","querySelector","Element","innerHTML","dataset","$tooltip","$arrow","overflowDir","parseInt","isNaN","round","css","pagex","originalEvent","pageX","arrowBoundary","arrowWidth","$hoverItemWrap","closest","mousex","offset","left","$textWrap","textWrapWidth","outerWidth","adjust","adjustDir","boundaryRight","clearTimeout","$keepBalloon","balloonSelector","hasClass","$children","children","not","loadToolTip","isTouch","$hoverItem","$boundary","tooltipHeight","outerHeight","tooltipTop","top","prop","addClass","$innerText","hoverItemWrapWidth","textWidth","textLeft","textRight","boundaryLeft","direction","horIndent","basis","indent","right","mouseEnter","item","_event","Event","trigger","stopPropagation","initTooltips","$wrap","addTooltipBoundary","combinedId","buttonNr","idParts","Error","Map","newData","json","Object","assign","txID","wcConf","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","promptCashPlugin"],"mappings":"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","file":"bundle.js","sourcesContent":["import {PromptCash} from \"./PromptCash\";\nimport {WebHelpers} from \"./WebHelpers\";\n\n\nexport class AbstractModule {\n    protected plugin: PromptCash;\n    protected webHelpers: WebHelpers;\n\n    constructor(plugin: PromptCash, webHelpers: WebHelpers = null) {\n        this.plugin = plugin;\n        this.webHelpers = webHelpers ? webHelpers : this.plugin.getWebHelpers();\n    }\n\n    // ################################################################\n    // ###################### PRIVATE FUNCTIONS #######################\n}\n","import {PromptCashConfig} from \"./PromptCash\";\n\nexport class Gateway {\n    protected lastPromptTxId: string = \"\";\n\n    protected config: PromptCashConfig;\n\n    constructor(config: PromptCashConfig) {\n        this.config = config;\n    }\n\n    public generateRandomTxId(postID: number): string {\n        const rand = this.getRandomString(4, false);\n        const unixTimestamp = Math.floor(Date.now() / 1000);\n        this.lastPromptTxId = `${postID}-${unixTimestamp}-${rand}`;\n        return this.lastPromptTxId;\n    }\n\n    public getLastGeneratedTxId(): string {\n        return this.lastPromptTxId;\n    }\n\n    public getPayFrameUrl(postID: number, amount: number, currency: string, type: string = \"Post\", description: string = \"\"): string {\n        const promptTxId = this.generateRandomTxId(postID);\n        currency = currency.toUpperCase(); // TODO undefined on tip button once. how?\n        const desc = encodeURI(description.length !== 0 ? description : `Post ${postID} @ ${this.config.siteUrl}`.trim());\n        const urlStr = this.config.frameUrl\n            .replace(\"{promptTxId}\", promptTxId)\n            .replace(\"{amount}\", amount.toFixed(8))\n            .replace(\"{currency}\", currency)\n            .replace(\"{desc}\", desc);\n        return urlStr;\n    }\n\n    // ################################################################\n    // ###################### PRIVATE FUNCTIONS #######################\n\n    protected getRandomString(len: number, hex = false) {\n        let chars = hex ? '1234567890ABCDEF' : '1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'\n        let random = ''\n        for (let i = 0; i < len; i++)\n            random += chars.charAt(Math.floor(Math.random() * chars.length))\n        return random\n    }\n}\n","import {AbstractModule} from \"./AbstractModule\";\nimport {PromptCash} from \"./PromptCash\";\nimport {PaymentResponse} from \"./structs/PaymentResponse\";\nimport {Gateway} from \"./Gateway\";\nimport {PaymentMap} from \"./structs/PaymentMap\";\nimport {PaymentType, RestPaymentParams} from \"./structs/RestPaymentParams\";\nimport {PaymentButtonID} from \"./structs/PaymentButtonID\";\n\nexport class Payment extends AbstractModule {\n    protected gateway: Gateway;\n    protected payments = new PaymentMap(); // pending payments to keep track\n    protected paymentType: PaymentType = \"WP\";\n    protected currentPayID: string = \"\"; // postID-counter\n\n    constructor(plugin: PromptCash) {\n        super(plugin);\n        this.gateway = new Gateway(this.plugin.getConfig());\n        const config = this.plugin.getConfig();\n\n        this.addPayFrameListeners();\n        this.plugin.$(this.plugin.window.document).ready(($) => {\n            if (config.woocommerce !== undefined && config.woocommerce.paymentPage === true) {\n                //this.isWoocommercePayment = this.plugin.$(\"body\").hasClass(\"woocommerce-order-received\") === true;\n                this.paymentType = \"WC\";\n            }\n            else if (this.plugin.$(\"h3.rcp_header\").length !== 0)\n                this.paymentType = \"RCP\";\n            this.addButtonEvents();\n        });\n    }\n\n    // ################################################################\n    // ###################### PRIVATE FUNCTIONS #######################\n\n    protected addButtonEvents() {\n        this.plugin.$(\".ct-button-tip\").on(\"click\", (event) => {\n            this.showPaymentFrame(event.target);\n        });\n        this.plugin.$(\".ct-input-amount\").on(\"change\", (event) => {\n            this.updateEditableButtonAmount(event.target);\n        });\n        this.plugin.$(\".ct-input-amount\").on(\"keyup\", (event) => {\n            this.updateEditableButtonAmount(event.target);\n        });\n    }\n\n    protected addPayFrameListeners() {\n        const config = this.plugin.getConfig();\n        const onMessage = (event) => {\n            if (event.origin !== config.gatewayOrigin) {\n                //this.webHelpers.log([\"Skipped message from different origin:\", event.origin]);\n                return;\n            }\n\n            // TODO currently our security relies on origin property from browser event.\n            //  we should add another check such as SHA2 signature for larger amounts\n            let data = event.data;\n            //if (typeof(window[data.func]) == \"function\") {\n                //window[data.func].call(null, data.message);\n            if (typeof(this[data.func]) === \"function\") {\n                try {\n                    this[data.func].call(this, data.data);\n                }\n                catch (err) {\n                    console.error(\"Error calling trusted event callback function: \", err);\n                }\n            }\n        }\n\n        if (window.addEventListener) {\n            window.addEventListener(\"message\", onMessage, false);\n        }\n        // @ts-ignore\n        else if (window.attachEvent) {\n            // @ts-ignore\n            window.attachEvent(\"onmessage\", onMessage, false);\n        }\n    }\n\n    protected onPromptPaid(data: PaymentResponse): Promise<void> {\n        return new Promise<void>((resolve, reject) => {\n            if (!data || data.status !== \"PAID\") {\n                this.webHelpers.log([\"received payment with invalid state\", data.status]);\n                return;\n            }\n\n            const config = this.plugin.getConfig();\n            this.scheduleRemovePayFrame();\n\n            const promptTxId = data.tx_id;\n            let payment = this.payments.mergeWithExisting(promptTxId, data);\n            const buttonWrapper = this.plugin.$(\".ct-btn-wrap-\" + this.currentPayID);\n            const button = buttonWrapper.find(\".ct-button-tip\");\n\n            const url = \"wp-json/promptcash/v1/register-payment\";\n            let params = this.paymentType === \"WP\" ? RestPaymentParams.fromButton(config, button, data) : RestPaymentParams.fromWoocommerceOrder(config, data);\n            this.webHelpers.getApi(url, params, (data) => {\n                if (data.data === undefined || data.error === true) {\n                    reject({text: \"invalid payment response\", res: data});\n                    return;\n                }\n\n                resolve();\n\n                if (this.paymentType === \"WC\") {\n                    // nothing to do currently. we show the frame a few seconds longer with confirmation icon\n                }\n                else if (this.paymentType === \"RCP\") {\n                    // nothing yet. done via full page payment and their webhook\n                }\n                else if (payment.is_restricted === true) {\n                    if (config.show_search_engines === true) {\n                        this.plugin.$(\"#ct-image-blurry-\" + this.currentPayID).fadeOut(\"slow\");\n                        this.plugin.$(\"#ct-hidden-\" + this.currentPayID).fadeIn(\"slow\");\n                    }\n                    else\n                        this.plugin.window.location.reload();\n                    return;\n                }\n            });\n        })\n    }\n\n    protected showPaymentFrame(button: Element) {\n        // there can only be 1 payment active\n        // hide all other payment frames (and show there buttons)\n        this.plugin.$(\".ct-button-frame\").fadeOut(\"slow\");\n        this.plugin.$(\".ct-button-wrap\").fadeIn(\"slow\");\n\n        const config = this.plugin.getConfig();\n        const $btn = this.plugin.$(button);\n        //const postID = parseInt($btn.attr(\"data-id\"));\n        const buttonIdStr = $btn.attr(\"data-id\");\n        this.currentPayID = buttonIdStr;\n        const paymentButtonID = new PaymentButtonID(buttonIdStr);\n        const amount = parseFloat($btn.attr(\"data-amount\"));\n        const currency = $btn.attr(\"data-currency\");\n        this.plugin.$(\".ct-btn-wrap-\" + buttonIdStr).fadeOut(\"slow\");\n\n        // create an iframe and append it\n        const frame = document.createElement(\"iframe\");\n        const type = this.paymentType === \"WC\" ? config.tr.order : config.tr.post; // WC frame is currently added on server, not here\n        frame.src = this.gateway.getPayFrameUrl(paymentButtonID.postID, amount, currency, type, config.title);\n        frame.scrolling = \"no\";\n        frame.style.overflow = \"hidden\";\n        frame.width = \"400px\";\n        frame.height = \"800px\";\n        const frameHolder = this.plugin.$(\".ct-button-frame-\" + buttonIdStr);\n        frameHolder.append(frame);\n        frameHolder.fadeIn(\"slow\");\n\n        const promptTxId = this.gateway.getLastGeneratedTxId();\n        let paymentEmpty = new PaymentResponse();\n        if ($btn.attr(\"data-restricted\") === \"1\")\n            paymentEmpty.is_restricted = true;\n        this.payments.set(promptTxId, paymentEmpty);\n    }\n\n    protected updateEditableButtonAmount(input: Element) {\n        const config = this.plugin.getConfig();\n        const $input = this.plugin.$(input);\n        const amount = parseFloat($input.val());\n        const $buttonWrap = this.plugin.$(\".ct-btn-wrap-\" + this.currentPayID);\n        $buttonWrap.find(\".ct-button-tip\").attr(\"data-amount\", amount);\n        $buttonWrap.find(\".ct-btn-display-amount\").text(amount);\n    }\n\n    protected scheduleRemovePayFrame() {\n        const config = this.plugin.getConfig();\n        const timeoutSec = this.paymentType === \"WC\" ? 5 : 0;\n        const frameID = this.paymentType === \"WP\" ? config.postID : config.woocommerce.orderID; // TODO RCP\n        const selector = \".ct-button-frame-\" + frameID + \", .ct-button-frame-\" + this.currentPayID;\n        setTimeout(() => {\n            // TODO what if we want multiple buttons per post? storing a new DB entry per shortcode is overkill (as Cashtippr)\n            this.plugin.$(selector).fadeOut(\"slow\");\n            setTimeout(() => {\n                this.plugin.$(selector).remove();\n            }, 1000);\n        }, timeoutSec * 1000);\n    }\n}\n","import {Tooltips} from \"./admin/Tooltips\";\nimport {WebHelpers, WebHelpersConfig} from \"./WebHelpers\";\nimport {Payment} from \"./Payment\";\nimport {AdminControls} from \"./admin/AdminControls\";\nimport {BrowserWindow} from \"./types\";\n\nexport interface PromptCashConfig extends WebHelpersConfig {\n    cookieLifeDays: number;\n    cookiePath: string;\n    siteUrl: string;\n    show_search_engines: boolean;\n    gatewayOrigin: string;\n    frameUrl: string;\n\n    // WP Post\n    postID: number;\n    title: string;\n\n    woocommerce?: {\n        amount: number;\n        currency: string;\n        orderID: number;\n        paymentPage: boolean;\n    }\n\n    // localizations\n    tr: {\n        order: string;\n        post: string;\n    }\n}\n\nexport interface PromptCashApiRes {\n    error: boolean;\n    errorMsg: string;\n    data: any[];\n}\n\nexport class PromptCash {\n    protected static readonly CONSENT_COOKIE_NAME = \"prc-ck\";\n    protected static readonly CONFIRM_COOKIES_MSG = \"#ct-cookieMsg\";\n    protected static readonly CONFIRM_COOKIES_BTN = \"#ct-confirmCookies\";\n    // TODO separate entryPoints + classes for admin + public code? but tooltips and other admin stuff can be used publicly too (and is quite small)\n\n    public readonly window: BrowserWindow;\n    public readonly $: JQueryStatic;\n\n    protected config: PromptCashConfig;\n    protected webHelpers: WebHelpers;\n    protected adminControls: AdminControls;\n    protected tooltips: Tooltips;\n    protected payment: Payment;\n\n    constructor(window: BrowserWindow, $: JQueryStatic) {\n        this.window = window;\n        this.$ = $;\n        this.config = this.window['promptCashCfg'] || {};\n        this.config.consentCookieName = PromptCash.CONSENT_COOKIE_NAME;\n        this.config.confirmCookiesMsg = PromptCash.CONFIRM_COOKIES_MSG;\n        this.config.confirmCookiesBtn = PromptCash.CONFIRM_COOKIES_BTN;\n\n        this.webHelpers = new WebHelpers(this.window, this.$, this.config);\n        this.tooltips = new Tooltips(this, this.webHelpers);\n        this.adminControls = new AdminControls(this);\n        this.payment = new Payment(this);\n        this.$(this.window.document).ready(($) => {\n            this.adminControls.init();\n            this.webHelpers.checkCookieConsent();\n        });\n    }\n\n    public getConfig() {\n        return this.config;\n    }\n\n    public getTooltips() {\n        return this.tooltips;\n    }\n\n    public getWebHelpers() {\n        return this.webHelpers;\n    }\n\n    // ################################################################\n    // ###################### PRIVATE FUNCTIONS #######################\n}\n","import {BrowserWindow} from \"./types\";\n\nexport interface WebHelpersConfig {\n    cookieLifeDays: number;\n    cookiePath: string;\n    siteUrl: string;\n\n    // DOM ids of elements of cookie consent message\n    consentCookieName: string;\n    confirmCookiesMsg: string;\n    confirmCookiesBtn: string;\n}\n\nexport class WebHelpers {\n    public readonly window: BrowserWindow;\n    public readonly $: JQueryStatic;\n\n    protected config: WebHelpersConfig;\n    protected cssSelectors: string[] = [];\n\n    constructor(window: BrowserWindow, $: JQueryStatic, config: WebHelpersConfig) {\n        this.window = window;\n        this.$ = $;\n        this.config = config;\n    }\n\n    public getBrowserLang() {\n        return this.window.navigator.language.substr(0, 2).toLowerCase();\n    }\n\n    public getCookie(c_name: string) {\n        let i, x, y;\n        let ARRcookies = this.window.document.cookie.split(\";\");\n        for (i = 0; i < ARRcookies.length; i++)\n        {\n            x = ARRcookies[i].substr(0, ARRcookies[i].indexOf(\"=\"));\n            y = ARRcookies[i].substr(ARRcookies[i].indexOf(\"=\") + 1);\n            x = x.replace(/^\\s+|\\s+$/g,\"\");\n            if (x == c_name)\n                return decodeURI(y);\n        }\n        return null;\n    }\n\n    public setCookie(name: string, value: any, expireDays: number) {\n        let date = new Date();\n        date = new Date(date.getTime()+1000*60*60*24* (expireDays ? expireDays : this.config.cookieLifeDays));\n        //document.cookie = name + \"=\" + value + \"; expires=\" + date.toGMTString() + \"; path=\" + pageData.cookiePath + \"; domain=.\" + location.host;\n        this.window.document.cookie = name + \"=\" + value + \"; expires=\" + date.toUTCString() + \"; path=\" + this.config.cookiePath;\n    }\n\n    public removeCookie(name: string) {\n        //document.cookie = name + \"=; expires=Thu, 02 Jan 1970 00:00:00 UTC; path=\" + pageData.cookiePath + \"; domain=.\" + location.host;\n        this.window.document.cookie = name + \"=; expires=Thu, 02 Jan 1970 00:00:00 UTC; path=\" + this.config.cookiePath;\n    }\n\n    public checkCookieConsent() {\n        this.$(this.config.confirmCookiesBtn).click(() => {\n            this.confirmCookies();\n        });\n        if (this.getCookie(this.config.consentCookieName) !== null)\n            this.$(this.config.confirmCookiesMsg).remove(); // we recently showed the cookie confirm message. some pages might still be in browser cache\n    }\n\n    public fromBase64(data: string) {\n        if (typeof this.window.atob !== \"function\") {\n            this.window.console.error(\"Base64 decoding is not supported in your browser\");\n            return \"\";\n        }\n        return this.window.atob(data);\n    }\n\n    public toBase64(data: string) {\n        if (typeof this.window.btoa !== \"function\") {\n            this.window.console.error(\"Base64 encoding is not supported in your browser\");\n            return \"\";\n        }\n        return this.window.btoa(data);\n    }\n\n    /**\n     * Populate a html template\n     * @param text {String}: The html template (or just normal text with variables)\n     * @param variables {Object}: the key-value pairs with variables names and their content to be set in text\n     * @param safeHtml {boolean, default false}: don't escape html characters if set to true\n     * @returns {String} the translated html\n     */\n    public translate(text: string, variables: any, safeHtml: boolean = false) {\n        if (typeof text !== \"string\") {\n            try {\n                // @ts-ignore\n                text = text.toString();\n            }\n            catch (e) {\n                this.log(\"Text to translate is not a string\");\n                return text;\n            }\n        }\n        let start = 0, end = 0;\n        while ((start = text.indexOf(\"{\", start)) !== -1)\n        {\n            if (start > 0 && text.charAt(start-1) === \"\\\\\") { // escaped javascript code beginning\n                start++;\n                continue;\n            }\n            end = text.indexOf(\"}\", start);\n            if (end === -1) {\n                this.log(\"Can not find end position while translating HTML\");\n                break;\n            }\n            let placeHolder = text.substring(start+1, end);\n            let translation = null;\n            if (placeHolder.substring(0, 3) === \"tr:\") {\n                let key = placeHolder.substring(3);\n                //translation = this.tr(key.toUpperCase());\n                translation = this.tr(key);\n            }\n            else if (typeof variables === \"object\") {\n                let textPiece = variables[placeHolder];\n                if (typeof textPiece !== \"undefined\") {\n                    if (typeof safeHtml === \"boolean\" && safeHtml)\n                        translation = textPiece;\n                    else\n                        translation = this.escapeOutput(textPiece);\n                }\n            }\n            if (translation !== null) {\n                let reg = new RegExp(\"\\\\{\" + placeHolder + \"\\\\}\", \"g\");\n                text = text.replace(reg, translation);\n            }\n            else if (placeHolder.match(\"^[A-Za-z0-9_]+$\") !== null) {\n                this.log(\"No translation found for place holder: \" + placeHolder);\n                let reg = new RegExp(\"\\\\{\" + placeHolder + \"\\\\}\", \"g\");\n                text = text.replace(reg, \"MISSING: \" + this.escapeOutput(placeHolder));\n            }\n            else\n                start += placeHolder.length;\n        }\n        text = text.replace(/\\\\\\\\\\\\{/, \"{\");\n        return text;\n    }\n\n    public escapeOutput(text: string, convertNewlines: boolean = true) {\n        if (typeof text !== \"string\")\n            return text;\n        text = text.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n        if (typeof convertNewlines === \"undefined\" || convertNewlines === true)\n            text = text.replace(/\\r?\\n/g, \"<br>\");\n        return text;\n    }\n\n    public escapeRegex(str: string) {\n        return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n    }\n\n    public tr(key: string) {\n        //if (typeof language[key] === \"undefined\")\n        //return \"MISSING: \" + key;\n        //return language[key];\n        //return i18next.t(key) // will just print the key if it doesn't exist and debug is disabled\n        return key; // we don't have client-side translation support on this WP plugin yet. just return the key // TODO do we need this if we make our plugin use more ajax?\n    }\n\n    public log(args) {\n        if (//typeof pageData.debugLog !== \"boolean\" || pageData.debugLog === false || // TODO add in CashTipprConfig\n            typeof this.window.console !== \"object\" || typeof this.window.console.log !== \"function\")\n            return;\n        this.window.console.log(arguments);\n    }\n\n    public isAppleIOS() {\n        // https://stackoverflow.com/questions/9038625/detect-if-device-is-ios\n        return /iPad|iPhone|iPod/.test(this.window.navigator.userAgent) && !(this.window as any).MSStream;\n    }\n\n    public getAllCssSelectors(cached = true): string[] {\n        if (cached === true && this.cssSelectors.length !== 0)\n            return this.cssSelectors;\n\n        this.cssSelectors = [];\n        try {\n            const originRegex = new RegExp(\"^\" + this.escapeRegex(this.window.document.location.origin), \"i\");\n            for (let i = 0; i < this.window.document.styleSheets.length; i++)\n            {\n                const sheet: any = this.window.document.styleSheets[i];\n                if (sheet.href && originRegex.test(sheet.href) === false)\n                    continue; // can't access it\n                if (sheet.rules) {\n                    for (let u = 0; u < sheet.rules.length; u++)\n                    {\n                        if (sheet.rules[u].selectorText)\n                            this.cssSelectors.push(sheet.rules[u].selectorText);\n                    }\n                }\n                if (sheet.imports) {\n                    for (let x = 0; x < sheet.imports.length; x++)\n                    {\n                        for (let u = 0; u < sheet.imports[x].rules.length; u++)\n                        {\n                            if (sheet.imports[x].rules[u].selectorText)\n                                this.cssSelectors.push(sheet.imports[x].rules[u].selectorText);\n                        }\n                    }\n                }\n            }\n        }\n        catch (err) {\n            this.window.console.error(\"Error getting CSS selectors\", err);\n        }\n        return this.cssSelectors;\n    }\n\n    public isExistingCssSelector(selector: string): boolean {\n        const selectors = this.getAllCssSelectors();\n        for (let i = 0; i < selectors.length; i++)\n        {\n            if (selectors[i] === selector) // css props case insensitive, class names in HTML case sensitive\n                return true;\n        }\n        return false;\n    }\n\n    // ################################################################\n    // ###################### PRIVATE FUNCTIONS #######################\n\n    protected confirmCookies() {\n        /* // no data stored in session\n        this.getApi('/json/cookies', function(data) {\n            if (data.error)\n                //Hlp.showMsg(i18next.t('errorSending'), 'danger');\n                console.error(\"Error sending data\");\n            else {\n            }\n        })\n        */\n        this.$(this.config.confirmCookiesMsg).remove();\n        this.setCookie(this.config.consentCookieName, \"1\", this.config.cookieLifeDays);\n    }\n\n    public getApi(path: string, data?: any, callback?: (data: any, textStatus: string, jqXHR: JQueryXHR) => any, dataType?: string) {\n        if (typeof data === \"function\") {\n            callback = data;\n            data = null;\n        }\n        else if (data === undefined)\n            data = null;\n        let url = this.fixRelativeUrl(path);\n        return this.$.get(url, data, (data, textStatus, jqXHR) => {\n            callback(data, textStatus, jqXHR);\n        }, dataType);\n    }\n\n    public postApi(path: string, data?: any, callback?: (data: any, textStatus: string, jqXHR: JQueryXHR) => any, dataType?: string) {\n        let url = this.fixRelativeUrl(path);\n        return this.$.post(url, data, (data, textStatus, jqXHR) => {\n            callback(data, textStatus, jqXHR);\n        }, dataType);\n    }\n\n    protected fixRelativeUrl(url: string): string {\n        if (url.toLowerCase().indexOf(\"http\") === 0)\n            return url; // already a full url\n        let fullUrl = this.config.siteUrl;\n        if (url.length !== 0 && url[0] === \"/\" && fullUrl[fullUrl.length-1] === \"/\")\n            fullUrl = fullUrl.substr(0, fullUrl.length-1); // avoid duplicate //\n        fullUrl += url;\n        return fullUrl;\n    }\n}\n","import {AbstractModule} from \"../AbstractModule\";\nimport {PromptCash} from \"../PromptCash\";\n\nexport class AdminControls extends AbstractModule {\n    constructor(plugin: PromptCash) {\n        super(plugin);\n    }\n\n    public init() {\n        if (this.plugin.$(\"body\").attr(\"class\").indexOf(\"promptcash\") === -1)\n            return; // not our plugin settings page\n\n        this.plugin.getTooltips().initToolTips();\n        this.plugin.$(this.plugin.window.document).ready(($) => {\n\n        });\n    }\n\n    // ################################################################\n    // ###################### PRIVATE FUNCTIONS #######################\n\n}\n","import {PromptCash} from \"../PromptCash\";\nimport {AbstractModule} from \"../AbstractModule\";\nimport {WebHelpers} from \"../WebHelpers\";\n\nexport class Tooltips extends AbstractModule {\n\n    constructor(plugin: PromptCash, webHelpers: WebHelpers) {\n        super(plugin, webHelpers);\n    }\n\n    /**\n     * Initializes status bar hover entries.\n     */\n    public initToolTips() {\n        const window = this.plugin.window;\n        const jQuery = this.plugin.$;\n        const that = this;\n        const tsfL10n = { // TODO localization\n            states: {\n                debug: false\n            }\n        }\n\n        let touchBuffer = 0,\n            inTouchBuffer = false;\n\n        const setTouchBuffer = function() {\n            inTouchBuffer = true;\n            clearTimeout( touchBuffer );\n            touchBuffer = window.setTimeout( function() {\n                inTouchBuffer = false;\n            }, 250 );\n        }\n\n        const setEvents = function( target, unset = false ) {\n\n            unset = unset || false;\n\n            let touchEvents = 'pointerdown.tsfTT touchstart.tsfTT click.tsfTT',\n                $target = jQuery( target );\n\n            if ( unset ) {\n                $target.off( 'mousemove mouseleave mouseout ct-tooltip-update' );\n                jQuery( document.body ).off( touchEvents );\n            } else {\n                $target.on( {\n                    'mousemove'  : mouseMove,\n                    'mouseleave' : mouseLeave,\n                    'mouseout'   : mouseLeave,\n                } );\n                jQuery( document.body ).off( touchEvents ).on( touchEvents, touchRemove );\n            }\n\n            $target.on( 'ct-tooltip-update', updateDesc );\n        }\n        const unsetEvents = function( target ) {\n            setEvents( target, true );\n        }\n        const updateDesc = function( event ) {\n            if ( event.target.classList.contains( 'ct-tooltip-item' ) ) {\n                let tooltipText = event.target.querySelector( '.ct-tooltip-text' );\n                if ( tooltipText instanceof Element )\n                    tooltipText.innerHTML = event.target.dataset.desc;\n            }\n        }\n        const mouseEnter = function( event ) {\n            let $hoverItem = jQuery( event.target ),\n                desc = event.target.dataset.desc;\n\n            if ( desc && 0 === $hoverItem.find( 'div' ).length ) {\n                //= Remove any titles attached.\n                event.target.title = \"\";\n\n                let $tooltip = jQuery(\n                    '<div class=\"ct-tooltip\"><span class=\"ct-tooltip-text-wrap\"><span class=\"ct-tooltip-text\">'\n                    + desc +\n                    '</span></span><div class=\"ct-tooltip-arrow\"></div></div>'\n                );\n                $hoverItem.append( $tooltip );\n\n                let $boundary = $hoverItem.closest( '.ct-tooltip-boundary' );\n                $boundary = $boundary.length && $boundary || jQuery( document.body );\n\n                //= 9 = arrow (8) + shadow (1)\n                let tooltipHeight = $hoverItem.outerHeight() + 9,\n                    tooltipTop = $tooltip.offset().top - tooltipHeight,\n                    boundaryTop = $boundary.offset().top - ( $boundary.prop( 'scrolltop' ) || 0 );\n\n                if ( boundaryTop > tooltipTop ) {\n                    $tooltip.addClass( 'ct-tooltip-down' );\n                    $tooltip.css( 'top', tooltipHeight + 'px' );\n                } else {\n                    $tooltip.css( 'bottom', tooltipHeight + 'px' );\n                }\n\n                let $hoverItemWrap = $hoverItem.closest( '.ct-tooltip-wrap' ),\n                    $textWrap = $tooltip.find( '.ct-tooltip-text-wrap' ),\n                    $innerText = $textWrap.find( '.ct-tooltip-text' ),\n                    hoverItemWrapWidth = $hoverItemWrap.width(),\n                    textWrapWidth = $textWrap.outerWidth( true ),\n                    textWidth = $innerText.outerWidth( true ),\n                    textLeft = $textWrap.offset().left,\n                    textRight = textLeft + textWidth,\n                    boundaryLeft = $boundary.offset().left - ( $boundary.prop( 'scrollLeft' ) || 0 ),\n                    boundaryRight = boundaryLeft + $boundary.outerWidth();\n\n                //= RTL and LTR are normalized to abide to left.\n                let direction = 'left';\n\n                if ( textLeft < boundaryLeft ) {\n                    //= Overflown over left boundary (likely window)\n                    //= Add indent relative to boundary. 24px width of arrow / 2 = 12 middle\n                    let horIndent = boundaryLeft - textLeft + 12,\n                        basis = parseInt( $textWrap.css( 'flex-basis' ), 10 );\n\n                    /**\n                     * If the overflow is greater than the tooltip flex basis,\n                     * the tooltip was grown. Shrink it back to basis and use that.\n                     */\n                    if ( horIndent < -basis )\n                        horIndent = -basis;\n\n                    $tooltip.css( direction, horIndent + 'px' );\n                    $tooltip.data( 'overflow', horIndent );\n                    $tooltip.data( 'overflowDir', direction );\n                } else if ( textRight > boundaryRight ) {\n                    //= Overflown over right boundary (likely window)\n                    //= Add indent relative to boundary. Add 12px for visual appeal.\n                    let horIndent = boundaryRight - textRight - hoverItemWrapWidth - 12,\n                        basis = parseInt( $textWrap.css( 'flex-basis' ), 10 );\n\n                    /**\n                     * If the overflow is greater than the tooltip flex basis,\n                     * the tooltip was grown. Shrink it back to basis and use that.\n                     */\n                    if ( horIndent < -basis )\n                        horIndent = -basis;\n\n                    $tooltip.css( direction, horIndent + 'px' );\n                    $tooltip.data( 'overflow', horIndent );\n                    $tooltip.data( 'overflowDir', direction );\n                } else if ( hoverItemWrapWidth < 42 ) {\n                    //= Small tooltip container. Add indent to make it visually appealing.\n                    let indent = -15;\n                    $tooltip.css( direction, indent + 'px' );\n                    $tooltip.data( 'overflow', indent );\n                    $tooltip.data( 'overflowDir', direction );\n                } else if ( hoverItemWrapWidth > textWrapWidth ) {\n                    //= Wrap is bigger than tooltip. Adjust accordingly.\n                    let pagex = event.originalEvent && event.originalEvent.pageX || event.pageX, // iOS touch support,\n                        hoverItemLeft = $hoverItemWrap.offset().left,\n                        center = pagex - hoverItemLeft,\n                        left = center - textWrapWidth / 2,\n                        right = left + textWrapWidth;\n\n                    if ( left < 0 ) {\n                        //= Don't overflow left.\n                        left = 0;\n                    } else if ( right > hoverItemWrapWidth ) {\n                        //= Don't overflow right.\n                        //* Use textWidth instead of textWrapWidth as it gets squashed in flex.\n                        left = hoverItemWrapWidth - textWidth;\n                    }\n\n                    $tooltip.css( direction, left + 'px' );\n                    $tooltip.data( 'adjust', left );\n                    $tooltip.data( 'adjustDir', direction );\n                }\n            }\n        }\n        const mouseMove = function( event ) {\n            let $target = jQuery( event.target ),\n                $tooltip = $target.find( '.ct-tooltip' ),\n                $arrow = $tooltip.find( '.ct-tooltip-arrow' ),\n                overflow = $tooltip.data( 'overflow' ),\n                overflowDir = $tooltip.data( 'overflowDir' );\n\n            overflow = parseInt( overflow, 10 );\n            overflow = isNaN( overflow ) ? 0 : - Math.round( overflow );\n\n            if ( overflow ) {\n                //= Static arrow based on static overflow.\n                $arrow.css( overflowDir, overflow + \"px\" );\n            } else {\n                let pagex = event.originalEvent && event.originalEvent.pageX || event.pageX, // iOS touch support\n                    arrowBoundary = 7,\n                    arrowWidth = 16,\n                    $hoverItemWrap = $target.closest( '.ct-tooltip-wrap' ),\n                    mousex = pagex - $hoverItemWrap.offset().left - arrowWidth / 2,\n                    originalMousex = mousex,\n                    $textWrap = $tooltip.find( '.ct-tooltip-text-wrap' ),\n                    textWrapWidth = $textWrap.outerWidth( true ),\n                    adjust = $tooltip.data( 'adjust' ),\n                    adjustDir = $tooltip.data( 'adjustDir' ),\n                    boundaryRight = textWrapWidth - arrowWidth - arrowBoundary;\n\n                //= mousex is skewed, adjust.\n                adjust = parseInt( adjust, 10 );\n                adjust = isNaN( adjust ) ? 0 : Math.round( adjust );\n                if ( adjust ) {\n                    adjust = 'left' === adjustDir ? -adjust : adjust;\n                    mousex = mousex + adjust;\n\n                    //= Use textWidth for right boundary if adjustment exceeds.\n                    if ( boundaryRight - adjust > $hoverItemWrap.outerWidth( true ) ) {\n                        let $innerText = $textWrap.find( '.ct-tooltip-text' ),\n                            textWidth = $innerText.outerWidth( true );\n                        boundaryRight = textWidth - arrowWidth - arrowBoundary;\n                    }\n                }\n\n                if ( mousex <= arrowBoundary ) {\n                    //* Overflown left.\n                    $arrow.css( 'left', arrowBoundary + \"px\" );\n                } else if ( mousex >= boundaryRight ) {\n                    //* Overflown right.\n                    $arrow.css( 'left', boundaryRight + \"px\" );\n                } else {\n                    //= Somewhere in the middle.\n                    $arrow.css( 'left', mousex + \"px\" );\n                }\n            }\n        }\n        const mouseLeave = function( event ) {\n\n            //* @see touchMove\n            if ( inTouchBuffer )\n                return;\n\n            jQuery( event.target ).find( '.ct-tooltip' ).remove();\n            unsetEvents( event.target );\n        }\n        /**\n         * ^^^\n         * These two methods conflict eachother in EdgeHTML.\n         * Thusly, touch buffer.\n         * vvv\n         */\n        const touchRemove = function( event ) {\n\n            //* @see mouseLeave\n            setTouchBuffer();\n\n            let itemSelector = '.ct-tooltip-item',\n                balloonSelector = '.ct-tooltip';\n\n            let $target = jQuery( event.target ),\n                $keepBalloon;\n\n            if ( $target.hasClass( 'ct-tooltip-item' ) ) {\n                $keepBalloon = $target.find( balloonSelector );\n            }\n            if ( ! $keepBalloon ) {\n                let $children = $target.children( itemSelector );\n                if ( $children.length ) {\n                    $keepBalloon = $children.find( balloonSelector );\n                }\n            }\n\n            if ( $keepBalloon && $keepBalloon.length ) {\n                //= Remove all but this.\n                jQuery( balloonSelector ).not( $keepBalloon ).remove();\n            } else {\n                //= Remove all.\n                jQuery( balloonSelector ).remove();\n            }\n        }\n\n        /**\n         * Loads tooltips within wrapper.\n         * @function\n         */\n        const loadToolTip = function( event ) {\n\n            if ( inTouchBuffer )\n                return;\n\n            let isTouch = false;\n\n            switch ( event.type ) {\n                case 'mouseenter' :\n                    //= Most likely, thus placed first.\n                    break;\n\n                case 'pointerdown' :\n                case 'touchstart' :\n                    isTouch = true;\n                    break;\n\n                default :\n                    break;\n            }\n\n            if ( event.target.classList.contains( 'ct-tooltip-item' ) ) {\n                //= Removes previous items and sets buffer.\n                isTouch && touchRemove( event );\n\n                mouseEnter( event );\n                //= Initiate placement directly for Windows Touch or when overflown.\n                mouseMove( event );\n\n                setEvents( event.target );\n            } else {\n                //= Delegate or bubble, and go back to this method with the correct item.\n                let item = event.target.querySelector( '.ct-tooltip-item:hover' ),\n                    _event = new jQuery.Event( event.type );\n\n                _event.pageX = event.originalEvent && event.originalEvent.pageX || event.pageX;\n\n                if ( item ) {\n                    if ( tsfL10n.states.debug ) console.log( 'Tooltip event warning: delegation' );\n                    jQuery( item ).trigger( _event );\n                } else {\n                    if ( tsfL10n.states.debug ) console.log( 'Tooltip event warning: bubbling' );\n                    jQuery( event.target ).closest( '.ct-tooltip-wrap' ).find( '.ct-tooltip-item:hover' ).trigger( _event );\n                }\n            }\n\n            //* Stop further propagation.\n            event.stopPropagation();\n        }\n\n        /**\n         * Initializes tooltips.\n         * @function\n         */\n        const initTooltips = function() {\n            let $wrap = jQuery( '.ct-tooltip-wrap' );\n\n            $wrap.off( 'mouseenter pointerdown touchstart' );\n            $wrap.on( 'mouseenter pointerdown touchstart', '.ct-tooltip-item', loadToolTip );\n        }\n        initTooltips();\n        jQuery( window ).on( 'ct-reset-tooltips', initTooltips );\n\n        (function() {\n            let e = jQuery( '#wpcontent' );\n            that.addTooltipBoundary( e );\n        })();\n    }\n\n    // ################################################################\n    // ###################### PRIVATE FUNCTIONS #######################\n\n    /**\n     * Adds tooltip boundaries.\n     */\n    protected addTooltipBoundary( e ) {\n        jQuery( e ).addClass( 'ct-tooltip-boundary' );\n    }\n\n    /**\n     * Triggers tooltip reset.\n     */\n    protected _triggerTooltipReset() { // not used yet\n        jQuery( window ).trigger( 'ct-reset-tooltips' );\n    }\n\n    /**\n     * Triggers active tooltip update.\n     */\n    protected _triggerTooltipUpdate(item) { // not used yet\n        jQuery( item ).trigger( 'ct-tooltip-update' );\n    }\n}\n","\nexport class PaymentButtonID {\n    public readonly postID: number = 0;\n    public readonly buttonNr: number = 0;\n\n    constructor(combinedId: string) {\n        const idParts = combinedId.split(\"-\");\n        if (idParts.length !== 2)\n            throw new Error(\"PaymentButtonID must have exactly 2 parts: postID-buttonNr\");\n        this.postID = parseInt(idParts[0]);\n        this.buttonNr = parseInt(idParts[1]);\n    }\n\n    public getButtonIdStr(): string {\n        return `${this.postID}-${this.buttonNr}`;\n    }\n}\n","import {PaymentResponse} from \"./PaymentResponse\";\n\nexport class PaymentMap extends Map<string, PaymentResponse> { // (prompt TX ID, pending payment)\n    constructor() {\n        super();\n    }\n\n    /**\n     * Merge certain pre-defined properties from the existing payment onto newData and return it.\n     * @param promptTxId\n     * @param newData\n     */\n    public mergeWithExisting(promptTxId: string, newData: PaymentResponse): PaymentResponse {\n        let payment = this.get(promptTxId);\n        if (payment !== undefined) { // should always be defined in our current payment flow\n            newData.is_restricted = payment.is_restricted;\n        }\n        this.set(promptTxId, newData);\n        return newData;\n    }\n}\n","\nexport type PaymentStatus = \"PENDING\" | \"PAID\" | \"CANCELLED\" | \"EXPIRED\" | \"HOLD\" | \"REFUNDED\";\n\nexport class PaymentResponse {\n    public readonly id: number;\n    public readonly tx_id: string; // the value the merchant supplied\n    public readonly token: string;\n    // TODO add more props\n    public readonly status: PaymentStatus;\n    public readonly paid_amount_crypto: number;\n    public readonly remaining_amount_crypto: number;\n    public readonly qr_url: string;\n    public readonly payment_link: string;\n    public readonly confirmations: number;\n\n    // added by TS client\n    public is_restricted: boolean = false;\n\n    constructor() {\n    }\n\n    public static fromJson(json: any): PaymentResponse {\n        return Object.assign(new PaymentResponse(), json); // copy properties\n    }\n\n    // ################################################################\n    // ###################### PRIVATE FUNCTIONS #######################\n\n}\n","import {PromptCashConfig} from \"../PromptCash\";\nimport {PaymentResponse} from \"./PaymentResponse\";\n\nexport type PaymentType = \"WP\" | \"WC\" | \"RCP\";\n\n/**\n * Payment parameters we send to WP REST API to validate a payment.\n */\nexport class RestPaymentParams {\n    public readonly amount: number;\n    public readonly currency: string;\n    public readonly postID: string;\n    public readonly txID: string;\n\n    protected type: PaymentType = \"WP\";\n\n    /**\n     * Creates new WC REST API params.\n     * @param amount\n     * @param currency\n     * @param postID postID-buttonNr (nr 0 for WC orders)\n     * @param txID\n     */\n    constructor(amount: number, currency: string, postID: string, txID: string) {\n        this.amount = amount;\n        this.currency = currency;\n        this.postID = postID;\n        this.txID = txID;\n    }\n\n    public static fromButton(config: PromptCashConfig, button: JQuery, data: PaymentResponse): RestPaymentParams {\n        let params = new RestPaymentParams(parseFloat(button.attr(\"data-amount\")),\n            button.attr(\"data-currency\"), button.attr(\"data-id\"), data.tx_id);\n        return params;\n    }\n\n    public static fromWoocommerceOrder(config: PromptCashConfig, data: PaymentResponse): RestPaymentParams {\n        const wcConf = config.woocommerce;\n        const orderID = `${wcConf.orderID}`;\n        let params = new RestPaymentParams(wcConf.amount, wcConf.currency, orderID, data.tx_id);\n        params.type = \"WC\";\n        return params;\n    }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import {PromptCash} from \"./src/PromptCash\";\n\nlet promptCashPlugin = new PromptCash(window as any, jQuery);\n(window as any).promptCashPlugin = promptCashPlugin;\n"],"sourceRoot":""}